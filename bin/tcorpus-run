#!/usr/bin/env perl

use strict;
use warnings;
use Test::Corpus qw(run_test_file);
use Getopt::Long;

my ($module, $method, $file);
GetOptions(
    'module=s' => \$module,
    'method=s' => \$method,
    'file=s'   => \$file,
) or die "Usage: $0 --module=Module --method=method --file=path.yml\n";

die "Missing required args\n" unless $module && $method && $file;

my $results = run_test_file($module, $method, $file);

for my $r (@$results) {
    printf "[%s] %s\n", $r->{status}, $r->{input} ? join(", ", %{$r->{input}}) : '';
    print "  Expected: $r->{expect}\n" if $r->{expect};
    print "  Got:      $r->{got}\n"     if $r->{got};
    print "  Error:    $r->{error}\n"   if $r->{error};
}
